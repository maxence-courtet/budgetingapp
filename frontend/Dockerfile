FROM node:20-slim

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .

# Railway injects env vars at build time for Docker builds
ARG NEXT_PUBLIC_API_URL
ARG AUTH0_DOMAIN
ARG AUTH0_CLIENT_ID
ARG AUTH0_CLIENT_SECRET
ARG AUTH0_SECRET
ARG APP_BASE_URL
ARG AUTH0_AUDIENCE

ENV NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL}
ENV AUTH0_DOMAIN=${AUTH0_DOMAIN}
ENV AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
ENV AUTH0_CLIENT_SECRET=${AUTH0_CLIENT_SECRET}
ENV AUTH0_SECRET=${AUTH0_SECRET}
ENV APP_BASE_URL=${APP_BASE_URL}
ENV AUTH0_AUDIENCE=${AUTH0_AUDIENCE}

RUN npm run build

ENV PORT=3000
EXPOSE 3000

CMD ["npm", "start"]
